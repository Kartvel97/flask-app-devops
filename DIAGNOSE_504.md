# üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 504

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Ansible (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω `ansible/inventory.ini`:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
cd ansible
ansible-playbook -i inventory.ini check-app-status.yml

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ansible-playbook -i inventory.ini restart-flask-app.yml
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ SSH (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç—å –∫ SSH –∫–ª—é—á—É –Ω–∞ –≤–∞—à
SSH_KEY="~/.ssh/flask-app-key.pem"
IP="52.29.151.247"  # Elastic IP (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π, –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh -i $SSH_KEY ubuntu@$IP "sudo docker ps -a"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
ssh -i $SSH_KEY ubuntu@$IP "sudo docker logs flask-app --tail 50"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø–æ—Ä—Ç 5000
ssh -i $SSH_KEY ubuntu@$IP "sudo netstat -tlnp | grep :5000"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
ssh -i $SSH_KEY ubuntu@$IP "free -h && df -h /"

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ssh -i $SSH_KEY ubuntu@$IP "sudo docker restart flask-app"

# 6. –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
ssh -i $SSH_KEY ubuntu@$IP "sudo docker stop flask-app && sudo docker rm flask-app && sudo docker run -d --name flask-app --restart always -p 5000:5000 -e FLASK_APP=src/app.py -e FLASK_ENV=production flask-app"
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –∫–ª—é—á –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ ~/.ssh/flask-app-key.pem
# –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –∫–ª—é—á—É –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
./scripts/check-app-remote.sh [–ø—É—Ç—å/–∫/ssh/key.pem]
```

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã 504 –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —É–ø–∞–ª

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ssh -i ~/.ssh/flask-app-key.pem ubuntu@52.29.151.247 "sudo docker ps -a | grep flask-app"
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
ssh -i ~/.ssh/flask-app-key.pem ubuntu@63.180.199.69 "sudo docker start flask-app"
```

### 2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–ª–æ –∏–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
ssh -i ~/.ssh/flask-app-key.pem ubuntu@63.180.199.69 "sudo docker restart flask-app"
```

### 3. –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –∏–ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ssh -i ~/.ssh/flask-app-key.pem ubuntu@63.180.199.69 "free -h && df -h /"
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã EC2 –∏–Ω—Å—Ç–∞–Ω—Å–∞

### 4. –û—à–∏–±–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh -i ~/.ssh/flask-app-key.pem ubuntu@63.180.199.69 "sudo docker logs flask-app --tail 100"
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑

### 5. –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –∏–ª–∏ –ø–æ—Ä—Ç–∞–º–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ssh -i ~/.ssh/flask-app-key.pem ubuntu@63.180.199.69 "sudo netstat -tlnp | grep :5000"
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Security Group –≤ AWS –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—Ä—Ç 5000 –æ—Ç–∫—Ä—ã—Ç

## –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
cd ansible
ansible-playbook -i inventory.ini deploy-flask-app.yml
```

–≠—Ç–æ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
curl http://52.29.151.247:5000/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"healthy","version":"1.0.0"}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã:
- **Grafana**: http://52.29.151.247:3000
- **Prometheus**: http://52.29.151.247:9090

